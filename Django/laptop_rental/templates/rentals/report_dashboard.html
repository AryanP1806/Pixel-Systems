{% extends 'base.html' %}
{% block title %}ğŸ“Š Report Dashboard{% endblock %}
{% block content %}
<h2>Rental Reports</h2>

<div class="section-grid">
  <div class="section"><a href="#top-assets">Top Performing Assets</a></div>
  <div class="section"><a href="#type-pie">Revenue by Type</a></div>
  <div class="section"><a href="#customer-bar">Customer Comparison</a></div>
</div>
<pre>


</pre>
<div><a
        href="{% url 'export_reports_csv' %}"
        class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded"
        style="padding: 8px 14px; background-color: #6366f1; color: white; border-radius: 6px; text-decoration: none; margin-right: 10px;"
      >
        Export CSV
      </a>
      
      <a
        href="{% url 'export_reports_excel' %}"
        class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded"
        style="padding: 8px 14px; background-color: #6366f1; color: white; border-radius: 6px; text-decoration: none; margin-right: 10px;"
      >
        Export Excel
      </a>
      <a
        href="{% url 'export_reports_pdf' %}"
        class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded"
        style="padding: 8px 14px; background-color: #6366f1; color: white; border-radius: 6px; text-decoration: none;"
      >
        Export PDF
      </a></div>
<div class="filters-section">
    <form method="get" id="filterForm">
      <div class="filters-grid">
        <div class="filter-group">
          <label for="customer">ğŸ‘¤ Customer</label>
          <select name="customer" id="customer">
            <option value="">All Customers</option>
            {% for c in customers %}
              <option value="{{ c.id }}" {% if request.GET.customer == c.id|stringformat:"s" %}selected{% endif %}>{{ c.name }}</option>
            {% endfor %}
          </select>
        </div>

        <div class="filter-group">
          <label for="product">ğŸ·ï¸ Asset</label>
          <select name="product" id="product">
            <option value="">All Assets</option>
            {% for p in products %}
              <option value="{{ p.id }}" {% if request.GET.product == p.id|stringformat:"s" %}selected{% endif %}>{{ p.asset_id }}</option>
            {% endfor %}
          </select>
        </div>

        <div class="filter-group">
          <label for="start_date">ğŸ“… Start Date</label>
          <input type="date" name="start_date" id="start_date" value="{{ request.GET.start_date }}">
        </div>

        <div class="filter-group">
          <label for="end_date">ğŸ“… End Date</label>
          <input type="date" name="end_date" id="end_date" value="{{ request.GET.end_date }}">
        </div>

        <div class="filter-group">
          <button type="submit" class="btn-primary">ğŸ” Generate Report</button>
        </div>
      </div>

      <!-- <div class="quick-filters">
        <a href="?customer_type=BNI" class="btn" style="padding: 8px 14px; background-color: #10b981; color: white; border-radius: 6px; text-decoration: none;">BNI</a>
        <a href="?customer_type=Permanent" class="btn" style="padding: 8px 14px; background-color: #6366f1; color: white; border-radius: 6px; text-decoration: none;">Permanent</a>
    
    </div> -->
    </form>
  </div>    




<hr>
<h2>Results</h2>
<ul>
  <li><strong>Total Rentals:</strong> {{ total_rentals }}</li>
  <li><strong>Total Days Rented:</strong> {{ total_days }}</li>
{% if product_id %}
    <h3>ğŸ’° Financial Summary for {{ product_obj.asset_id }}</h3>
    <li><strong>Purchase Price:</strong> â‚¹ {{ purchase_price }}</li>
    <li><strong>Gross Profit:</strong> â‚¹ {{ gross_profit }}</li>
    <li><strong>Maintenance Cost:</strong> â‚¹ {{ maintenance_cost }}</li>
    {% if sold_asset %}
      <li><strong>Sold Asset:</strong> â‚¹ {{ sold_asset }}</li>
    {% endif %}
    
      <li><strong>Net Profit:</strong> â‚¹ {{ net_profit }}</li>
    
{% else %}
  <li><strong>Total Revenue:</strong> â‚¹ {{ total_revenue }}</li>
{% endif %}



</ul>
<div style="max-width: 800px; margin: auto;">
<canvas id="revenueChart"></canvas>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const ctx = document.getElementById('revenueChart').getContext('2d');
  const revenueChart = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: {{ monthly_labels|safe }},
      datasets: [{
        label: 'Monthly Revenue (â‚¹)',
        data: {{ monthly_values|safe }},
        backgroundColor: 'rgba(54, 162, 235, 0.6)',
        borderColor: 'rgba(54, 162, 235, 1)',
        borderWidth: 1
      }]
    },
    options: {
      scales: {
        y: {
          beginAtZero: true,
          ticks: {
            precision: 0
          }
        }
      }
    }
  });
</script>
</div>
<hr>
<h3 id="type-pie">ğŸ§© Revenue by Asset Type</h3>
<div style="max-width: 600px; margin: auto;">
<canvas id="typePieChart" width="400" height="150"></canvas>
<script>
  new Chart(document.getElementById('typePieChart'), {
    type: 'pie',
    data: {
      labels: {{ type_labels|safe }},
      datasets: [{
        label: 'Revenue',
        data: {{ type_values|safe }},
        backgroundColor: ['#007bff', '#ffc107', '#28a745', '#dc3545', '#6c757d','#6610f2', '#e83e8c'],
      }]
    }
  });
</script>
</div>
<hr>
<h3 id="top-assets">ğŸ“Š Top Performing Assets</h3>
<table border="1" cellpadding="6">
  <tr><th>Asset</th><th>Total Income (â‚¹)</th></tr>
  {% for asset in top_assets %}
    <tr>
      <td>{{ asset.asset_id }} ({{ asset.brand }} {{ asset.model_no }})</td>
      <td>â‚¹ {{ asset.total_income }}</td>
    </tr>
  {% endfor %}
</table>
<hr>
<h3 id="customer-bar">ğŸ† Customers by Rental Business</h3>

<div style="max-width: 800px; margin: auto;">
<canvas id="customerBarChart" width="400" height="150"></canvas>
<script>
  new Chart(document.getElementById('customerBarChart'), {
    type: 'bar',
    data: {
      labels: {{ customer_labels|safe }},
      datasets: [{
        label: 'Total â‚¹ from Customer',
        data: {{ customer_values|safe }},
        backgroundColor: '#17a2b8'
      }]
    },
    options: {
      indexAxis: 'y',
      scales: {
        x: {
          beginAtZero: true,
          ticks: { precision: 0 }
        }
      }
    }
  });
</script>
</div>

{% endblock %}
