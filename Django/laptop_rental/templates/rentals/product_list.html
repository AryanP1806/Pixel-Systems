{% extends 'base.html' %}
{% load custom_filters %}

<h2>{% block title %}Product List{% endblock %}</h2>
{% block content %}
<h2>Product List</h2>

<a href="{% url 'add_product' %}"><button>â• Add Product</button></a>

{% if messages %}
<ul>
  {% for message in messages %}
  <li style="color: green">{{ message }}</li>
  {% endfor %}
</ul>
{% endif %}
<!-- <select name="type">
    <option value="">All Types</option>
    {% for t in asset_types %}
      <option value="{{ t }}" {% if asset_type == t %}selected{% endif %}>{{ t }}</option>
    {% endfor %}
  </select> -->

  <div class="filters-section">
    <form method="get" id="filterForm">
        <div class="filters-grid">
            <!-- Asset Type Filter -->
            <!-- <div class="filter-group">
                <label for="type">ğŸ·ï¸ Asset Type</label>
                <select name="type" id="type">
                  <option value="">All Types</option>
                  {% for asset_type in asset_types %}
                  <option value="{{ asset_type.id }}" {% if selected_type == asset_type.id|stringformat:"s" %}selected{% endif %}>
                    {{ asset_type.name }}
                  </option>
                  {% endfor %}
                </select>
              </div> -->
              <div class="filter-group">
                <p>ğŸ”Search</p>   
                <input type="text" name="q" placeholder="Search..." value="{{ query|default:'' }}">
              </div>
              <div class="filter-group">
                <p>â¬†â¬‡Sort by:</p>
                          <select name="sort">
                  <option value='-asset_id' {% if sort_by == '-asset_id' %}selected{% endif %}>Newest First</option>
                  <option value='asset_id' {% if sort_by == 'asset_id' %}selected{% endif %}>Oldest First</option>
                </select>
              </div>
              <!-- Start Date -->
            <div class="filter-group">
                <label for="start_date">ğŸ“… Start Date</label>
                <input type="date" name="start_date" id="start_date" value="{{ start_date }}">
            </div>

            <!-- End Date -->
            <div class="filter-group">
                <label for="end_date">ğŸ“… End Date</label>
                <input type="date" name="end_date" id="end_date" value="{{ end_date }}">
            </div>
            <!-- Submit Button -->
            <div class="filter-group">
                <button type="submit" class="btn-primary">ğŸ” Filter</button>
            </div>

  
  <!-- <select name="year" id="year-select">
      {% for y in year_list %}
          <option value="{{ y }}" {% if y == selected_year %}selected{% endif %}>{{ y }}</option>
      {% endfor %}
  </select> -->
  
        </div>

    </form>
</div>





<div class="table-container" tabindex="0">
  <table border="1" cellpadding="8">
    <thead>
    <tr>
      <th>Checked By</th>
      <th>Purchase Date</th>
      <th>Asset Id</th>
      <th>Type</th>
      <th>Brand</th>
      <th>Model No</th>
      <th>Warranty</th>
      <th>Status</th>
      <th>Actions</th>
    </tr>
    </thead>
    <tbody>
    {% for p in products %}
    <tr>
      <td>{{ p.edited_by.username }}{{product.edited_at|date:"Y-m-d H:i:s"}}</td>
      <td>{{ p.purchase_date }}</td>
      <td>{{ p.asset_id }} </td>
      <td>{{ p.type_of_asset }}</td>
      <td>{{ p.brand }}</td>
      <td>{{ p.model_no }}</td>
      <td>
        {% if p.under_warranty %} {{ p.warranty_duration_months }} months
        <p></p>
        {% else %} No
        <p></p>
        {% endif %}
      </td>
    <td>
    {% if p.condition_status == 'sold' %}
        <span style="color: purple;">Sold</span>
    {% elif p.condition_status == 'missing' %}
        <span style="color: red;">Missing</span>
    {% elif p.condition_status == 'damaged' %}
        <span style="color: orange;">Damaged</span>
    {% elif p.is_available %}
        <span style="color: green;">Available</span>
    {% else %}
        {% if p.id in active_rentals %}
            <span style="color: grey;">{{ p|rented_by }}</span>
        {% else %}
            <span style="color: green;">{{ p|rented_by }}</span>
        {% endif %}
    {% endif %}
</td>

    <!-- <td>â‚¹ {{ p.net_profit }}</td> -->
      <td>
        <a href="{% url 'product_detail' p.pk %}"><button>View</button></a> |
        <a href="{% url 'edit_product' p.pk %}"><button>Edit</button></a> |
        <!-- <a href="{% url 'add_repair' p.pk %}"><button>Repair</button></a> |
        <a href="{% url 'add_config' p.pk %}"><button>Config</button></a> | -->
        <a href="{% url 'clone_product' p.pk %}"><button>Clone</button></a>
      </td>
    </tr>
    {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
